<html>
<head>
<title>NCAA Tournament Bracket</title>
<link rel="stylesheet" href="css/style.css">
<!--JBB Don't need script below since using classList.add/remove-->
<script>
Element.prototype.hasClassName = function(name) {
  return new RegExp("(?:^|\\s+)" + name + "(?:\\s+|$)").test(this.className);
};

Element.prototype.addClassName = function(name) {
  if (!this.hasClassName(name)) {
    this.className = this.className ? [this.className, name].join(' ') : name;
  }
};

Element.prototype.removeClassName = function(name) {
  if (this.hasClassName(name)) {
    var c = this.className;
    this.className = c.replace(new RegExp("(?:^|\\s+)" + name + "(?:\\s+|$)", "g"), "");
  }
};
</script>
</head>

<body>
<section class="main">
  <header>
    <h1>Welcome to the empyre.com NCAA pool</h1>
  </header>
  <div class="main">
    <div class="menu-bar">
      <button type="button" class="menu-button" id="clearAll" onclick="handleClear();">Clear</button>
      <button type="button" class="menu-button" id="autoFill" onclick="handleAutofill();">Auto Fill</button>
    </div>
    <div class="column-titles">
      <div class="one-column">1st Round</div>
      <div class="one-column">2nd Round</div>
      <div class="one-column">Sweet 16</div>
      <div class="one-column">Great 8</div>
      <div class="one-column">Final Four</div>
      <div class="one-column">Championship</div>
    </div>

    <!--ROUND 1 GAMES-->
    <div class="one-column">
      <div class="one-box-round1">
        <!--quarter1, round, game1, team1-->
        <span class="seed">1</span>
        <span draggable="true" class="team-box" id="q1r1g1t1">North Carolina</span>
        <hr class="team-box-hr">
        <span class="seed">16</span>
        <span draggable="true" class="team-box" id="q1r1g1t2">Richmond</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">8</span>
        <span draggable="true" class="team-box" id="q1r1g2t1">Kentucky</span>
        <hr class="team-box-hr">
        <span class="seed">9</span>
        <span draggable="true" class="team-box" id="q1r1g2t2">BYU</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">12</span>
        <span draggable="true" class="team-box" id="q1r1g3t1">UCLA</span>
        <hr class="team-box-hr">
        <span class="seed">5</span>
        <span draggable="true" class="team-box" id="q1r1g3t2">USC</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">13</span>
        <span draggable="true" class="team-box" id="q1r1g4t1">Stanford</span>
        <hr class="team-box-hr">
        <span class="seed">4</span>
        <span draggable="true" class="team-box" id="q1r1g4t2">Arizona</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">3</span>
        <span draggable="true" class="team-box" id="q1r1g5t1">Indiana</span>
        <hr class="team-box-hr">
        <span class="seed">14</span>
        <span draggable="true" class="team-box" id="q1r1g5t2">Michigan St.</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">6</span>
        <span draggable="true" class="team-box" id="q1r1g6t1">Ohio St.</span>
        <hr class="team-box-hr">
        <span class="seed">11</span>
        <span draggable="true" class="team-box" id="q1r1g6t2">Utah</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">10</span>
        <span draggable="true" class="team-box" id="q1r1g7t1">Colorado</span>
        <hr class="team-box-hr">
        <span class="seed">7</span>
        <span draggable="true" class="team-box" id="q1r1g7t2">Texas</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">15</span>
        <span draggable="true" class="team-box" id="q1r1g8t1">Fordham</span>
        <hr class="team-box-hr">
        <span class="seed">2</span>
        <span draggable="true" class="team-box" id="q1r1g8t2">Duke</span>
      </div>
      <hr class="quarter-break">
      <div class="one-box-round1">
        <span class="seed">1</span>
        <span draggable="true" class="team-box" id="q2r1g1t1">N Carolina</span>
        <hr class="team-box-hr">
        <span class="seed">16</span>
        <span draggable="true" class="team-box" id="q2r1g1t2">Rich</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">8</span>
        <span draggable="true" class="team-box" id="q2r1g2t1">Kent</span>
        <hr class="team-box-hr">
        <span class="seed">9</span>
        <span draggable="true" class="team-box" id="q2r1g2t2">BY</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">12</span>
        <span draggable="true" class="team-box" id="q2r1g3t1">UCL</span>
        <hr class="team-box-hr">
        <span class="seed">5</span>
        <span draggable="true" class="team-box" id="q2r1g3t2">SC</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">13</span>
        <span draggable="true" class="team-box" id="q2r1g4t1">Stan</span>
        <hr class="team-box-hr">
        <span class="seed">4</span>
        <span draggable="true" class="team-box" id="q2r1g4t2">Ariz</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">3</span>
        <span draggable="true" class="team-box" id="q2r1g5t1">Ind</span>
        <hr class="team-box-hr">
        <span class="seed">14</span>
        <span draggable="true" class="team-box" id="q2r1g5t2">Michigan</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">6</span>
        <span draggable="true" class="team-box" id="q2r1g6t1">Ohio</span>
        <hr class="team-box-hr">
        <span class="seed">11</span>
        <span draggable="true" class="team-box" id="q2r1g6t2">Utah St.</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">10</span>
        <span draggable="true" class="team-box" id="q2r1g7t1">Col</span>
        <hr class="team-box-hr">
        <span class="seed">7</span>
        <span draggable="true" class="team-box" id="q2r1g7t2">Tex</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">15</span>
        <span draggable="true" class="team-box" id="q2r1g8t1">Ford</span>
        <hr class="team-box-hr">
        <span class="seed">2</span>
        <span draggable="true" class="team-box" id="q2r1g8t2">Wake</span>
      </div>
      <hr class="quarter-break">
      <div class="one-box-round1">
        <span class="seed">1</span>
        <span draggable="true" class="team-box" id="q3r1g1t1">Carolina</span>
        <hr class="team-box-hr">
        <span class="seed">16</span>
        <span draggable="true" class="team-box" id="q3r1g1t2">ich</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">8</span>
        <span draggable="true" class="team-box" id="q3r1g2t1">ent</span>
        <hr class="team-box-hr">
        <span class="seed">9</span>
        <span draggable="true" class="team-box" id="q3r1g2t2">Y</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">12</span>
        <span draggable="true" class="team-box" id="q3r1g3t1">CL</span>
        <hr class="team-box-hr">
        <span class="seed">5</span>
        <span draggable="true" class="team-box" id="q3r1g3t2">C</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">13</span>
        <span draggable="true" class="team-box" id="q3r1g4t1">tan</span>
        <hr class="team-box-hr">
        <span class="seed">4</span>
        <span draggable="true" class="team-box" id="q3r1g4t2">riz</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">3</span>
        <span draggable="true" class="team-box" id="q3r1g5t1">nd</span>
        <hr class="team-box-hr">
        <span class="seed">14</span>
        <span draggable="true" class="team-box" id="q3r1g5t2">ichigan</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">6</span>
        <span draggable="true" class="team-box" id="q3r1g6t1">hio</span>
        <hr class="team-box-hr">
        <span class="seed">11</span>
        <span draggable="true" class="team-box" id="q3r1g6t2">tah St.</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">10</span>
        <span draggable="true" class="team-box" id="q3r1g7t1">ol</span>
        <hr class="team-box-hr">
        <span class="seed">7</span>
        <span draggable="true" class="team-box" id="q3r1g7t2">ex</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">15</span>
        <span draggable="true" class="team-box" id="q3r1g8t1">ord</span>
        <hr class="team-box-hr">
        <span class="seed">2</span>
        <span draggable="true" class="team-box" id="q3r1g8t2">ake</span>
      </div>
      <hr class="quarter-break">
      <div class="one-box-round1">
        <span class="seed">1</span>
        <span draggable="true" class="team-box" id="q4r1g1t1">N Carolina</span>
        <hr class="team-box-hr">
        <span class="seed">16</span>
        <span draggable="true" class="team-box" id="q4r1g1t2">Rich</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">8</span>
        <span draggable="true" class="team-box" id="q4r1g2t1">Kent</span>
        <hr class="team-box-hr">
        <span class="seed">9</span>
        <span draggable="true" class="team-box" id="q4r1g2t2">BY</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">12</span>
        <span draggable="true" class="team-box" id="q4r1g3t1">UCL</span>
        <hr class="team-box-hr">
        <span class="seed">5</span>
        <span draggable="true" class="team-box" id="q4r1g3t2">SC</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">13</span>
        <span draggable="true" class="team-box" id="q4r1g4t1">Stan</span>
        <hr class="team-box-hr">
        <span class="seed">4</span>
        <span draggable="true" class="team-box" id="q4r1g4t2">Ariz</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">3</span>
        <span draggable="true" class="team-box" id="q4r1g5t1">Ind</span>
        <hr class="team-box-hr">
        <span class="seed">14</span>
        <span draggable="true" class="team-box" id="q4r1g5t2">Michigan</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">6</span>
        <span draggable="true" class="team-box" id="q4r1g6t1">Ohio</span>
        <hr class="team-box-hr">
        <span class="seed">11</span>
        <span draggable="true" class="team-box" id="q4r1g6t2">Utah St.</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">10</span>
        <span draggable="true" class="team-box" id="q4r1g7t1">Col</span>
        <hr class="team-box-hr">
        <span class="seed">7</span>
        <span draggable="true" class="team-box" id="q4r1g7t2">Tex</span>
      </div>
      <div class="one-box-round1">
        <span class="seed">15</span>
        <span draggable="true" class="team-box" id="q4r1g8t1">Ford</span>
        <hr class="team-box-hr">
        <span class="seed">2</span>
        <span draggable="true" class="team-box" id="q4r1g8t2">Wake</span>
      </div>
    </div>
    <!--ROUND 2 GAMES-->
    <div class="one-column">
      <div class="one-box-round2-top">
        <span draggable="true" class="team-box" id="q1r2g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r2g1t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q1r2g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r2g2t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q1r2g3t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r2g3t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q1r2g4t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r2g4t2"></span>
      </div>

      <div class="one-box-round2-new-quarter">
        <span draggable="true" class="team-box" id="q2r2g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r2g1t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q2r2g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r2g2t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q2r2g3t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r2g3t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q2r2g4t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r2g4t2"></span>
      </div>

      <div class="one-box-round2-new-quarter">
        <span draggable="true" class="team-box" id="q3r2g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r2g1t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q3r2g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r2g2t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q3r2g3t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r2g3t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q3r2g4t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r2g4t2"></span>
      </div>

      <div class="one-box-round2-new-quarter">
        <span draggable="true" class="team-box" id="q4r2g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r2g1t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q4r2g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r2g2t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q4r2g3t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r2g3t2"></span>
      </div>
      <div class="one-box-round2">
        <span draggable="true" class="team-box" id="q4r2g4t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r2g4t2"></span>
      </div>

    </div>
    <!--ROUND 3 GAMES-->
    <div class="one-column">
      <div class="one-box-round3-top">
        <span draggable="true" class="team-box" id="q1r3g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r3g1t2"></span>
      </div>
      <div class="one-box-round3">
        <span draggable="true" class="team-box" id="q1r3g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r3g2t2"></span>
      </div>

      <div class="one-box-round3-new-quarter">
        <span draggable="true" class="team-box" id="q2r3g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r3g1t2"></span>
      </div>
      <div class="one-box-round3">
        <span draggable="true" class="team-box" id="q2r3g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r3g2t2"></span>
      </div>

      <div class="one-box-round3-new-quarter">
        <span draggable="true" class="team-box" id="q3r3g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r3g1t2"></span>
      </div>
      <div class="one-box-round3">
        <span draggable="true" class="team-box" id="q3r3g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r3g2t2"></span>
      </div>

      <div class="one-box-round3-new-quarter">
        <span draggable="true" class="team-box" id="q4r3g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r3g1t2"></span>
      </div>
      <div class="one-box-round3">
        <span draggable="true" class="team-box" id="q4r3g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r3g2t2"></span>
      </div>

    </div>
    <!--ROUND 4 GAMES-->
    <div class="one-column">
      <div class="one-box-round4-top">
        <span draggable="true" class="team-box" id="q1r4g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q1r4g1t2"></span>
      </div>
      <div class="one-box-round4">
        <span draggable="true" class="team-box" id="q2r4g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q2r4g1t2"></span>
      </div>
      <div class="one-box-round4">
        <span draggable="true" class="team-box" id="q3r4g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q3r4g1t2"></span>
      </div>
      <div class="one-box-round4">
        <span draggable="true" class="team-box" id="q4r4g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="q4r4g1t2"></span>
      </div>
    </div>

    <!--ROUND 5 GAMES-->
    <div class="one-column">
      <div class="one-box-round5-top">
        <span draggable="true" class="team-box" id="ff1r1g1t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="ff1r1g1t2"></span>
      </div>
      <div class="one-box-round5">
        <span draggable="true" class="team-box" id="ff1r1g2t1"></span>
        <hr class="team-box-hr">
        <span draggable="true" class="team-box" id="ff1r1g2t2"></span>
      </div>
    </div>

    <!--ROUND 6 GAMES-->
    <div class="one-column">
      <span class="finals-text-top">Champion</span>
      <div class="one-box-round6-top">
        <span draggable="true" class="team-box" id="ff1r2g1t1"></span>
      </div>
      <hr class="team-box-hr">
      <div class="one-box-round6">
        <span draggable="true" class="team-box" id="ff1r2g1t2"></span>
      </div>
      Finalist
    </div>

  </div>
  <!--end main-->

</section>

<br clear=all>
<hr class="bottom-break">
<!--JBB need to pretty up classes for down here-->
<!--<form id="post-picks" name="post-picks" action="process_submission.php" method="post">-->
<form id="post-picks" name="post-picks" action="processor.cgi" method="post">
  <input type=hidden id="picks" name="picks">
  <input type=text size=20 name="username" placeholder="username"><br>
  <input type=password size=20 name="password" placeholder="password"><br>
</form>
<button type="button" id="submit-button" class="submit-button" onclick="handleSubmit();">Submit Picks</button><br>
JBB - Could have picks submitted automatically each time you make a change.
i.e, not submit button<br>
JBB - Write picks to local storage as we go or grab all picks at time of submit?
JBB - Use local storage?
JBB - Restore a particular set of picks for editing later? requires user/pw
JBB - What if person wants to make multiple entries
JBB - Store MAC or something to limit num entries per thingy?
JBB - Right now you can overwrite someone else's entry. Could have a math problem to solve

<script>
var dragSrcEl = null;
var dropZoneId = null;
var dragSrcId = null;
var finalistHalf = null;
var championHalf = null;


function handleDragStart(event) {
  //this.style.opacity = '0.4';
  this.classList.add('selected');

  dragSrcEl = this;

  event.dataTransfer.effectAllowed = 'copy';
  event.dataTransfer.setData('text/html', this.innerHTML);
}

function handleDragOver(event) {
  if (event.preventDefault) {
    event.preventDefault();
  }
  event.dataTransfer.dropEffect = 'copy';

  return false;
}

function handleDragEnter(event) {
  //this.addClassName('over');
  if (!(this === dragSrcEl)) {
    //See that it is an eligible drop point. i.e., deeper in
    //tournament and on same path (same quarter, etc.).
    //["q1r1g1t1", "q", "1", "1", "1", "1"]
    dragSrcId = 
      RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(dragSrcEl.id);
    dropZoneId = RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(this.id);
    //if q1 or q2 then ff1r1 or ff1r2. if q3/q4 then ff2f1 or ff1r2
    var quarterValid = false;
    var roundValid = false;
    var gameValid = false;
    var teamValid = false;
    var finalFourGame = Math.ceil(dragSrcId[2]/2); //1 or 2
    //valid quarter
    if 
      ((dropZoneId[2] === dragSrcId[2]) ||  
      ((dropZoneId[1] == "ff") && (dropZoneId[4] == finalFourGame)) ||
      ((dropZoneId[1] == "ff") && (dropZoneId[3] == 2)))
    {
      quarterValid = true;
    }
    //valid round
    if (quarterValid) {
      if 
      ((dropZoneId[3] > dragSrcId[3]) ||  
      ((dropZoneId[1] == "ff") && (dragSrcId[1] == "q")) ||
      ((dragSrcId[1] == "ff") && (dropZoneId[1] == "ff" ) &&
      (dropZoneId[3] == 2)))
      {
        roundValid = true;
      }
    }
    // valid game
    if (quarterValid && roundValid) {
      var denominator = Math.pow(2, dropZoneId[3] - dragSrcId[3]);
      var gameCalc = Math.ceil(dragSrcId[4] / denominator);
      if 
      ((gameCalc == dropZoneId[4]) || 
      ((parseInt(dropZoneId[4]) == finalFourGame) && (dropZoneId[1] == "ff")) ||
      ((dropZoneId[1] == "ff" ) && (dropZoneId[3] == 2)))
      
      {
        gameValid = true;
      }
    }
    // valid team
    if (quarterValid && roundValid && gameValid) {
      //find game in round before. Odd means team 1.
      var denominator = Math.pow(2, dropZoneId[3] - dragSrcId[3] - 1);
      var priorGameCalc = Math.ceil(dragSrcId[4] / denominator);
      priorGameCalc = priorGameCalc % 2;
      qtrSrcOddEven = dragSrcId[2] % 2;
      switch(dropZoneId[1])
      {
      case 'q':
        if 
        (((priorGameCalc == 0 ) && (dropZoneId[5] == 2)) || 
        ((priorGameCalc == 1 ) &&  (dropZoneId[5] == 1)))
        {
          teamValid = true;
        }
        break;
      case 'ff':
        if (dropZoneId[3] == 2) {
          // compare champ and finalist to be sure different
          var checkEl;
          var checkId;
          dropZoneId[5] == 1 ? checkId = 'ff1r2g1t2' : checkId = 'ff1r2g1t1';
          checkEl = document.getElementById(checkId);
          if (checkEl) {
            if (checkEl.innerHTML != dragSrcEl.innerHTML) {
              teamValid = true;
            }
          }
        } else if 
          (((dropZoneId[5] == 1) && (qtrSrcOddEven == 1 )) ||
          ((dropZoneId[5] == 2) && (qtrSrcOddEven == 0 )))
        {
          teamValid = true;
        }
        break;
      }
    }

    if (quarterValid && roundValid && gameValid && teamValid) {
      if (!this.classList.contains('over')) {
        this.classList.add('over');
      }
    }
  }
}

function handleDragLeave(event) {
  //this.removeClassName('over');
  if (this.classList.contains('over')) {
    this.classList.remove('over');
  }
}

function handleDrop(event) {
  if (event.stopPropagation) {
    event.stopPropagation();
  }

  if ((dragSrcEl != this) && (this.classList.contains('over'))) {
    //dragSrcEl.innerHTML = this.innerHTML; //swap
    //dragSrcEl.style.opacity = '1.0';
    dragSrcEl.classList.remove('selected');
    forwardFill(dropZoneId, this.innerHTML, dragSrcEl.innerHTML);
    backFill(dragSrcId, dropZoneId);
    this.innerHTML = event.dataTransfer.getData('text/html');
    // JBB if champ see if finalist exists and is from same quarter
    // if so, need to wipe it. Also need to set half value for this team
    if ((dropZoneId[1] == 'ff') && (dropZoneId[3] == 2)) {
      if (dropZoneId[5] == 2) {
        finalistHalf = calculateHalf(dragSrcId);
        if (championHalf === finalistHalf) {
          document.getElementById('ff1r2g1t1').innerHTML = "";
        }
      } else {
        championHalf = calculateHalf(dragSrcId);
        if (championHalf === finalistHalf) {
          document.getElementById('ff1r2g1t2').innerHTML = "";
        }
      }
    }
    console.log('champ: ' + championHalf);
    console.log('finalist: ' + finalistHalf);

    but = document.getElementById('autoFill')
    but.disabled = true;
    //but.hidden = true;
  }

  return false;
}

function handleDragEnd(event) {
  [].forEach.call(teams, function (team) {
    team.classList.remove('over');
  });
  dragSrcEl.classList.remove('selected');
}

function calculateHalf(srcId) {
  if 
  (
  ((srcId[1] == 'ff') && (srcId[4] == 2)) ||
  ((srcId[1] == 'q') && (parseInt(srcId[2]) > 2))
  )
  {
    return 2;
  } else {
    console.log(srcId)
    return 1;
  }
}


// Replace all forward instances of old content with new
function forwardFill(target, oldContent, newContent) {
  if ((target[1] == "ff") && (target[3] == 2)) { return; }
  var round = parseInt(target[3]);
  [].forEach.call(teams, function(team) {
    if ((team.innerHTML == oldContent) && (oldContent != "")) {
      var oldContentArr = RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(team.id);
      if (((parseInt(oldContentArr[3]) > round) && (target[1] != "ff")) || 
        ((oldContentArr[1] == "ff") && (dragSrcId[1] != "ff"))) 
      {
        team.innerHTML = newContent; 
      }
    }
  });
}

// recursively populate earlier rounds with selection
function backFill(src, target) {
  if 
    (((parseInt(target[3], 10) - parseInt(src[3], 10)) > 1) || 
    ((target[1] == "ff") && (src[1] == "q"))) 
  {
    //do calculation to get correct ID and set value
    var nextId = "q" + src[2] + "r" + (parseInt(src[3], 10) + 1); //qtr & rd
    nextId += "g" + (Math.round(src[4] / 2)) + "t"; 
    var priorGameCalc = src[4] % 2;
    (priorGameCalc == 1 ? nextId += "1" : nextId += "2");
    var nextEl = document.getElementById(nextId);
    if (nextEl != null) {
      nextEl.innerHTML = dragSrcEl.innerHTML; 
      var nextSrcArr = 
        RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(nextEl.id);
      backFill(nextSrcArr, target);
    } else if ((parseInt(target[3], 10) == 2) && (src[1] != "ff")) { 
      // using fact that a ff target from q src will eventually go null
      //3 ff teams and two rounds. If ff1r2 (champ) then populate ff1r1
      switch(src[2])
      {
      case '1':
        nextEl = document.getElementById('ff1r1g1t1');
        nextEl.innerHTML = dragSrcEl.innerHTML; 
        break;
      case '2':
        nextEl = document.getElementById('ff1r1g1t2');
        nextEl.innerHTML = dragSrcEl.innerHTML; 
        break;
      case '3':
        nextEl = document.getElementById('ff1r1g2t1');
        nextEl.innerHTML = dragSrcEl.innerHTML; 
        break;
      case '4':
        nextEl = document.getElementById('ff1r1g2t2');
        nextEl.innerHTML = dragSrcEl.innerHTML; 
        break;
      }
    }
  }
}

function handleClear() {
  [].forEach.call(teams, function(team) {
    var oldContentArr = 
      RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(team.id);
    if ((parseInt(oldContentArr[3]) > 1) || (oldContentArr[1] == 'ff')) {
        team.innerHTML = ""; 
    }
  });
  document.getElementById('autoFill').disabled = false;
}

function handleAutofill(teams) {
  teams = typeof(teams) == 'undefined' ? roundOneTeams : teams;
  var nextTeams = {};
  var nextRd;
  var nextGm;
  var idArr = [];
  var nextId;
  var validNextTeam = false;
  var recurse = false;
  var nextEl;
  for (var key in teams) {
    switch(key)
    {
    case 'q1r1g1t1':
      el = document.getElementById('ff1r1g1t1');
      if (el) { el.innerHTML = teams[key]; }
      el = document.getElementById('ff1r2g1t1');
      if (el) { el.innerHTML = teams[key]; }
      break;
    case 'q2r1g1t1':
      el = document.getElementById('ff1r1g1t2');
      if (el) { el.innerHTML = teams[key]; }
      break;
    case 'q3r1g1t1':
      el = document.getElementById('ff1r1g2t1');
      if (el) { el.innerHTML = teams[key]; }
      el = document.getElementById('ff1r2g1t2');
      if (el) { el.innerHTML = teams[key]; }
      break;
    case 'q4r1g1t1':
      el = document.getElementById('ff1r1g2t2');
      if (el) { el.innerHTML = teams[key]; }
      break;
    }

    var idArr = RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(key);
    var gm = parseInt(idArr[4]);
    var tm = parseInt(idArr[5]);
    nextRd = parseInt(idArr[3]) + 1;
    nextGm = Math.ceil(gm / 2);
    nextId = "q" + idArr[2] + "r" + nextRd + "g" + nextGm;
    validNextTeam = false;
    // % 4 for round 1, % 2 subsequently
    if (parseInt(idArr[3]) == 1) {
      var mod = gm % 4;
      if (((mod == 1) || (mod == 2)) && (tm == 1)) {
        validNextTeam = true;
        nextId += mod == 1 ? "t1" : "t2";
      } else if (((mod == 0) || (mod == 3)) && (tm == 2)) {
        validNextTeam = true;
        nextId += mod == 0 ? "t2" : "t1";
      }
    } else {
      if (((gm % 2 ) == 1) && (tm == 1)) {
        nextId += "t1";
        validNextTeam = true;
      } else if (((gm % 2 ) == 0) && (tm == 2)) {
        nextId += "t2";
        validNextTeam = true;
      }
    }    
    if (validNextTeam) { 
      nextEl = document.getElementById(nextId);
      if (nextEl) {
        nextEl.innerHTML = teams[key];
        nextTeams[nextId] = teams[key];
        recurse = true;
      }
    }
  }
  if (recurse) {
    recurse = false;
    handleAutofill(nextTeams);
  }
  document.getElementById('autoFill').disabled = true;
}

var roundOneTeams = [];  // id => name
var teams = document.querySelectorAll('.team-box');
[].forEach.call(teams, function(team) {
  team.addEventListener('dragstart', handleDragStart, false);
  team.addEventListener('dragenter', handleDragEnter, false);
  team.addEventListener('dragover', handleDragOver, false);
  team.addEventListener('dragleave', handleDragLeave, false);
  team.addEventListener('drop', handleDrop, false);
  team.addEventListener('dragend', handleDragEnd, false);
  var teamArr = RegExp(/(\w+)(\d+)r(\d+)g(\d+)t(\d+)/).exec(team.id);
  if 
    ((parseInt(teamArr[3]) == 1) && 
    (teamArr[1] == 'q'))
  {
    roundOneTeams[team.id] = team.innerHTML;
  } 
});

function handleSubmit() {
//build JSON var with all picks, user, pw, MAC and anything else we capture
//update form variable and submit form
/*  
  var theForm = document.getElementsByName('post-picks');
  theForm.username = "JBB";
  theForm.password = "a password was here";
  theForm.picks = "JSON obj goes here";
  theForm.submit();
  */


  var theForm = document.getElementById('post-picks');
  theForm.password.value = "test password";
  if (theForm.username.value == "") {
    alert("Please provide a user name");
  } else {
  var picks = "";
  //var json_picks =  eval("(" + picks + ")");
  //var fullPicks = {w11: "Stanford", w12: "UNC Charlotte", e11: "UConn", e12: "Winston-Salem"};
  //var JSONstr = JSON.stringify(fullPicks);
    
    [].forEach.call(teams, function(team) {
      //{team.id: team.innerHTML;}
      //want the above JSON in the picks form var
      //theForm.picks.value = eval(json_str);;
      picks += team.id + "," + team.innerHTML + ",";
    });
    theForm.picks.value = picks;
    theForm.submit();
  }    
}

</script>

</body>
</html>
